export let state = { users: [{username:'admin',pass:'3134630773',role:'admin',fullname:'Administrador'}], currentUser: null, foundations: [], items: [], packs: ['Atado','Bulto','Canastilla','Caja','Unidad'], drivers: [], plates: [], pedidos: [], audit: [] }; export function saveState(){ localStorage.setItem('erp_state', JSON.stringify(state)); } export function loadStateFromStorage(){ try{ const s = JSON.parse(localStorage.getItem('erp_state')||'null'); if(s) Object.assign(state, s); }catch(e){console.warn('loadState error',e);} } export function mergeRemote(remote){ if(!remote) return; (remote.foundations||[]).forEach(f=>{ if(!state.foundations.some(x=>x.nit===f.nit)) state.foundations.push(f); }); (remote.items||[]).forEach(it=>{ if(!state.items.some(x=>x.ref===it.ref)) state.items.push(it); }); (remote.plates||[]).forEach(p=>{ if(!state.plates.some(x=>x.plate===p.plate)) state.plates.push(p); }); (remote.drivers||[]).forEach(d=>{ if(!state.drivers.some(x=>x.name===d.name && x.document===d.document)) state.drivers.push(d); }); (remote.pedidos||[]).forEach(p=>{ if(!state.pedidos.some(x=>x.id===p.id)) state.pedidos.push(p); }); saveState(); }